DATAPATH=/afs/cs.cmu.edu/project/bigML/
INPUTV=$(DATAPATH)netflix-ratings/training_set

#INPUTV=s3://cmu-bigml/netflix-ratings/training_set
OUTPUTW=./w.csv
OUTPUTH=./h.csv

#SPARKPATH=/usr/local/Cellar/spark-1.3.0-bin-hadoop2.4/bin/

SPARKIP=spark://207.184.161.138:7077
SPARKPATH=/home/hadoop/spark/bin/
SPARK=$(SPARKPATH)spark-submit --master $(SPARKIP)

LAMBDA=0.1

tq1:
	$(SPARK) q1.py 100 100 2 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > tq1
q1:
	$(SPARK) q1.py 100 100 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q1

tq2:
	time $(SPARK) q2.py 100 10 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > tq2
q2:
	time $(SPARK) q2.py 100 10 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q21
	time $(SPARK) q2.py 100 20 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q22
	time $(SPARK) q2.py 100 30 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q23
	time $(SPARK) q2.py 100 40 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q24
	time $(SPARK) q2.py 100 50 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q25
	time $(SPARK) q2.py 100 60 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q26
	time $(SPARK) q2.py 100 70 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q27
	time $(SPARK) q2.py 100 80 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q28
	time $(SPARK) q2.py 100 90 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q29
	time $(SPARK) q2.py 100 100 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q210

tq34:
	$(SPARK) q34.py 10 100 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > tq3
q3:
	$(SPARK) q34.py 10 100 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q31
	$(SPARK) q34.py 20 100 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q32
	$(SPARK) q34.py 30 100 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q33
	$(SPARK) q34.py 40 100 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q34
	$(SPARK) q34.py 50 100 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q35
	$(SPARK) q34.py 60 100 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q36
	$(SPARK) q34.py 70 100 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q37
	$(SPARK) q34.py 80 100 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q38
	$(SPARK) q34.py 90 100 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q39
	$(SPARK) q34.py 100 100 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q310

q4:
	$(SPARK) q34.py 100 100 100 0.1 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q41
	$(SPARK) q34.py 100 100 100 0.2 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q42
	$(SPARK) q34.py 100 100 100 0.3 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q43
	$(SPARK) q34.py 100 100 100 0.4 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q44
	$(SPARK) q34.py 100 100 100 0.5 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q45
	$(SPARK) q34.py 100 100 100 0.6 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q46
	$(SPARK) q34.py 100 100 100 0.7 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q47
	$(SPARK) q34.py 100 100 100 0.8 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q48
	$(SPARK) q34.py 100 100 100 0.9 $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH) > q49

eval:
		python eval_acc.py $(LOG) $(SPARK) $(MAIN) $(NUM_FACTOR) $(NUM_WORKER) $(NUM_ITER) $(BETA) $(LAMBDA) $(TRAINV) $(OUTPUTW) $(OUTPUTH)  
val:
		python eval.pyc $(LOG) $(SPARK) $(MAIN) $(NUM_FACTOR) $(NUM_WORKER) $(NUM_ITER) $(BETA) $(LAMBDA) $(TRAINV) $(OUTPUTW) $(OUTPUTH)  

clean:
	rm -f *.class
tar:
	tar -cvf hw7.tar *.py *.csv *.log juipinw-report.pdf

#	pyspark $(MAIN) $(NUM_FACTOR) $(NUM_WORKER) $(NUM_ITER) $(BETA) $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH)  
run:
	$(SPARK) $(MAIN) $(NUM_FACTOR) $(NUM_WORKER) $(NUM_ITER) $(BETA) $(LAMBDA) $(INPUTV) $(OUTPUTW) $(OUTPUTH)  
